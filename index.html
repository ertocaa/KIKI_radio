<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>KIKI Radio Player</title>
    <style>
        /* Stili precedenti invariati */
    </style>
</head>
<body>
    <!-- Struttura HTML invariata -->
    
    <script>
        const config = {
            audioUrl: 'https://radiokiki.out.airtime.pro/radiokiki_a',
            metadataUrl: 'https://api.allorigins.win/raw?url=' + 
                        encodeURIComponent('https://radiokiki.airtime.pro/api/live-info'),
            updateInterval: 3000
        };

        async function updateMetadata() {
            try {
                const response = await fetch(config.metadataUrl);
                const metadata = await response.json();
                
                // Estrazione dati corretta
                const currentTrack = metadata.current.metadata;
                const currentShow = metadata.currentShow[0];
                
                trackTitle.textContent = currentTrack.track_title || currentShow?.name || 'Trasmissione in diretta';
                trackArtist.textContent = currentTrack.artist_name || 'KIKI Radio';
                
                loader.textContent = `Ultimo aggiornamento: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error('Errore:', error);
                loader.textContent = 'Errore nel caricamento metadati';
            }
        }

        // Controlli audio
        playPauseBtn.addEventListener('click', () => {
            isPlaying = !isPlaying;
            playPauseBtn.textContent = isPlaying ? '⏸' : '▶';
            isPlaying ? audioElement.play() : audioElement.pause();
        });

        // Aggiornamento periodico metadati
        setInterval(updateMetadata, config.updateInterval);
        updateMetadata();

        // Gestione errori audio
        audioElement.addEventListener('error', (e) => {
            console.error('Errore audio:', e);
            loader.textContent = 'Errore nella riproduzione';
        });
    </script>
</body>
</html>
