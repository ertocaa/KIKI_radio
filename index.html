<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIKI Radio Player</title>
    <style>
        /* Aggiungi questi nuovi stili */
        .next-show {
            color: #AFFF04;
            font-size: 0.8em;
            margin-top: 10px;
            padding: 8px 0;
            border-top: 1px solid #3A3A3A;
            display: none;
        }

        .next-show span {
            opacity: 0.7;
        }

        /* Modifica lo stile esistente */
        .metadata-status {
            border-top: none;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="controls">
            <button id="playPauseBtn">â–¶</button>
            <div class="track-info">
                <div class="track-title" id="trackTitle">KIKI Radio</div>
                <div class="track-artist" id="trackArtist">Caricamento in corso...</div>
            </div>
        </div>
        <div class="next-show" id="nextShow">
            <span>Prossimo: </span><span id="nextProgram"></span>
        </div>
        <div class="metadata-status" id="metadataStatus"></div>
    </div>

    <script>
        // Modifica solo queste parti dello script esistente

        // Aggiungi alla sezione Elementi UI
        const elements = {
            playPauseBtn: document.getElementById('playPauseBtn'),
            trackTitle: document.getElementById('trackTitle'),
            trackArtist: document.getElementById('trackArtist'),
            metadataStatus: document.getElementById('metadataStatus'),
            nextShow: document.getElementById('nextShow'),
            nextProgram: document.getElementById('nextProgram'),
            audio: new Audio(config.audioUrl)
        };

        // Modifica la funzione updateDisplay
        function updateDisplay(data) {
            const currentTrack = data.current?.metadata || {};
            const currentShow = data.currentShow?.[0] || {};
            const nextShowData = data.nextShow?.[0] || null;

            // Metadati correnti
            elements.trackTitle.textContent = 
                currentTrack.track_title?.trim() || 
                currentShow.name?.trim() || 
                config.defaultTitle;

            elements.trackArtist.textContent = 
                currentTrack.artist_name?.trim() || 
                config.defaultArtist;

            // Prossimo programma
            if(nextShowData && nextShowData.name) {
                try {
                    const startTime = new Date(nextShowData.starts);
                    const formattedTime = startTime.toLocaleTimeString('it-IT', {
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    elements.nextProgram.textContent = `${nextShowData.name} alle ${formattedTime}`;
                    elements.nextShow.style.display = 'block';
                } catch(e) {
                    console.error('Errore formato data:', e);
                    elements.nextShow.style.display = 'none';
                }
            } else {
                elements.nextShow.style.display = 'none';
            }
        }

        // Aggiungi alla gestione errori
        async function updateMetadata() {
            try {
                // ... codice esistente ...
            } catch (error) {
                // ... codice esistente ...
                elements.nextShow.style.display = 'none';
            }
        }
    </script>
</body>
</html>
